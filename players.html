<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Ù„Ø§Ø¹Ø¨ÙˆÙ†ÙŠ Ù…Ø¹Ø§ÙƒÙ… - Ø§Ø­Ø¬Ø²Ù„ÙŠ</title>
  
  <!-- Bootstrap + Icons -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.css">
  
  <!-- Google Fonts -->
  <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@300;400;500;600;700&display=swap" rel="stylesheet">
  
  <style>
    :root {
      --primary-color: #1a7f46;
      --secondary-color: #2ecc71;
      --accent-color: #f39c12;
      --dark-color: #2c3e50;
      --light-color: #ecf0f1;
      --gold-color: #ffd700;
    }
    
    body {
      font-family: 'Cairo', sans-serif;
      background: #f8f9fa;
    }
    
    .golden-slot-card {
      background: linear-gradient(135deg, #fff9e6, #fff3cd);
      border: 3px solid var(--gold-color);
      border-radius: 15px;
      padding: 1.5rem;
      margin-bottom: 1.5rem;
      position: relative;
      overflow: hidden;
      transition: all 0.3s ease;
      box-shadow: 0 5px 20px rgba(255, 215, 0, 0.2);
    }
    
    .golden-slot-card:hover {
      transform: translateY(-5px);
      box-shadow: 0 10px 30px rgba(255, 215, 0, 0.3);
    }
    
    .golden-slot-card::before {
      content: 'ğŸ‘¥ Ø¨Ø­Ø§Ø¬Ø© Ù„Ù„Ø§Ø¹Ø¨ÙŠÙ†';
      position: absolute;
      top: 15px;
      left: 15px;
      background: var(--gold-color);
      color: #000;
      padding: 0.3rem 0.8rem;
      border-radius: 20px;
      font-size: 0.8rem;
      font-weight: bold;
      z-index: 2;
    }
    
    .players-needed-badge {
      background: linear-gradient(135deg, #ff6b6b, #ee5a24);
      color: white;
      padding: 0.3rem 0.8rem;
      border-radius: 15px;
      font-size: 0.8rem;
      font-weight: bold;
    }
    
    .request-card {
      border-right: 4px solid var(--primary-color);
      border-radius: 12px;
      padding: 1.5rem;
      margin-bottom: 1rem;
      background: white;
      box-shadow: 0 3px 15px rgba(0,0,0,0.1);
      transition: all 0.3s ease;
    }
    
    .request-card:hover {
      transform: translateY(-3px);
      box-shadow: 0 5px 20px rgba(0,0,0,0.15);
    }
    
    .request-card.pending {
      border-right-color: var(--accent-color);
      background: #fffaf0;
    }
    
    .request-card.accepted {
      border-right-color: var(--secondary-color);
      background: #f0fff4;
    }
    
    .request-card.rejected {
      border-right-color: #e74c3c;
      background: #fff5f5;
    }
    
    .stats-card {
      background: linear-gradient(135deg, #667eea, #764ba2);
      color: white;
      border-radius: 15px;
      padding: 1.5rem;
      text-align: center;
      margin-bottom: 1.5rem;
    }
    
    .stats-number {
      font-size: 2.5rem;
      font-weight: bold;
      margin-bottom: 0.5rem;
    }
    
    .stats-label {
      font-size: 0.9rem;
      opacity: 0.9;
    }
    
    .nav-links {
      background: linear-gradient(135deg, var(--primary-color), var(--secondary-color));
      padding: 1rem 0;
    }
    
    .nav-links a {
      color: white;
      text-decoration: none;
      margin: 0 15px;
      font-weight: 600;
      transition: opacity 0.3s ease;
    }
    
    .nav-links a:hover {
      opacity: 0.8;
    }
    
    .filter-buttons {
      background: white;
      padding: 1rem;
      border-radius: 12px;
      margin-bottom: 2rem;
      box-shadow: 0 3px 15px rgba(0,0,0,0.1);
    }
    
    .empty-state {
      text-align: center;
      padding: 3rem 1rem;
      color: #6c757d;
    }
    
    .empty-state i {
      font-size: 4rem;
      margin-bottom: 1rem;
      opacity: 0.5;
    }
    
    .time-badge {
      background: var(--primary-color);
      color: white;
      padding: 0.3rem 0.8rem;
      border-radius: 20px;
      font-size: 0.8rem;
      font-weight: 600;
    }
    
    .join-btn {
      background: linear-gradient(135deg, var(--gold-color), #ffed4e);
      color: #000;
      border: none;
      font-weight: 600;
      padding: 0.5rem 1.5rem;
      border-radius: 25px;
      transition: all 0.3s ease;
    }
    
    .join-btn:hover {
      transform: translateY(-2px);
      box-shadow: 0 5px 15px rgba(255, 215, 0, 0.4);
    }
    
    .tab-content {
      min-height: 500px;
    }
    
    .activity-indicator {
      width: 10px;
      height: 10px;
      border-radius: 50%;
      display: inline-block;
      margin-left: 5px;
    }
    
    .activity-indicator.active {
      background: var(--secondary-color);
      animation: pulse 1.5s infinite;
    }
    
    @keyframes pulse {
      0% { opacity: 1; }
      50% { opacity: 0.5; }
      100% { opacity: 1; }
    }
    
    .location-badge {
      background: #e3f2fd;
      color: #1976d2;
      padding: 0.2rem 0.6rem;
      border-radius: 12px;
      font-size: 0.7rem;
      font-weight: 600;
    }

    /* Toast Notifications */
    .toast-container {
      position: fixed;
      top: 20px;
      left: 20px;
      z-index: 9999;
    }
    
    .custom-toast {
      border: none;
      border-radius: 10px;
      box-shadow: 0 5px 20px rgba(0,0,0,0.2);
    }
    
    .toast-success {
      background: linear-gradient(135deg, #00b09b, #96c93d);
    }
    
    .toast-error {
      background: linear-gradient(135deg, #ff416c, #ff4b2b);
    }
    
    .toast-warning {
      background: linear-gradient(135deg, #f7971e, #ffd200);
    }
    
    .loading-spinner {
      display: inline-block;
      width: 20px;
      height: 20px;
      border: 3px solid #f3f3f3;
      border-top: 3px solid #3498db;
      border-radius: 50%;
      animation: spin 1s linear infinite;
    }
    
    @keyframes spin {
      0% { transform: rotate(0deg); }
      100% { transform: rotate(360deg); }
    }
  </style>
</head>
<body>

  <nav class="nav-links">
    <div class="container">
      <div class="d-flex justify-content-between align-items-center">
        <a class="navbar-brand text-white fw-bold" href="/">
          <i class="bi bi-people-fill me-2"></i> Ù„Ø§Ø¹Ø¨ÙˆÙ†ÙŠ Ù…Ø¹Ø§ÙƒÙ…
        </a>
        <div>
          <a href="/">
            <i class="bi bi-house me-1"></i> Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©
          </a>
          <a href="/players-with-you" class="fw-bold">
            <i class="bi bi-people me-1"></i> Ù„Ø§Ø¹Ø¨ÙˆÙ†ÙŠ Ù…Ø¹Ø§ÙƒÙ…
          </a>
          <a href="/profile">
            <i class="bi bi-person me-1"></i> Ù…Ù„ÙÙŠ Ø§Ù„Ø´Ø®ØµÙŠ
          </a>
          <a href="#" onclick="logout()">
            <i class="bi bi-box-arrow-left me-1"></i> ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø®Ø±ÙˆØ¬
          </a>
        </div>
      </div>
    </div>
  </nav>

  <div class="container my-4">
    <!-- Ø§Ù„Ø¹Ù†ÙˆØ§Ù† ÙˆØ§Ù„Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª -->
    <div class="row mb-4">
      <div class="col-12">
        <div class="text-center mb-4">
          <h1 class="display-4 fw-bold text-success">
            <i class="bi bi-people-fill me-2"></i>Ù„Ø§Ø¹Ø¨ÙˆÙ†ÙŠ Ù…Ø¹Ø§ÙƒÙ… âš½
          </h1>
          <p class="lead text-muted">Ø§Ù†Ø¶Ù… Ø¥Ù„Ù‰ Ù…Ø¨Ø§Ø±ÙŠØ§Øª ØªØ­ØªØ§Ø¬ Ù„Ø§Ø¹Ø¨ÙŠÙ† Ø£Ùˆ Ø§Ø·Ù„Ø¨ Ù„Ø§Ø¹Ø¨ÙŠÙ† Ù„Ù…Ø¨Ø§Ø±Ø§ØªÙƒ</p>
        </div>
      </div>
    </div>

    <!-- Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª Ø³Ø±ÙŠØ¹Ø© -->
    <div class="row mb-4">
      <div class="col-md-3 mb-3">
        <div class="stats-card">
          <div class="stats-number" id="totalGoldenSlots">0</div>
          <div class="stats-label">Ø³Ø§Ø¹Ø© Ø°Ù‡Ø¨ÙŠØ© Ù†Ø´Ø·Ø©</div>
        </div>
      </div>
      <div class="col-md-3 mb-3">
        <div class="stats-card">
          <div class="stats-number" id="totalRequests">0</div>
          <div class="stats-label">Ø·Ù„Ø¨ Ø§Ù†Ø¶Ù…Ø§Ù…</div>
        </div>
      </div>
      <div class="col-md-3 mb-3">
        <div class="stats-card">
          <div class="stats-number" id="acceptedRequests">0</div>
          <div class="stats-label">Ø·Ù„Ø¨ Ù…Ù‚Ø¨ÙˆÙ„</div>
        </div>
      </div>
      <div class="col-md-3 mb-3">
        <div class="stats-card">
          <div class="stats-number" id="activePlayers">0</div>
          <div class="stats-label">Ù„Ø§Ø¹Ø¨ Ù†Ø´Ø·</div>
        </div>
      </div>
    </div>

    <!-- ØªØ¨ÙˆÙŠØ¨Ø§Øª Ø§Ù„ØµÙØ­Ø© -->
    <ul class="nav nav-pills nav-justified mb-4" id="playersTabs" role="tablist">
      <li class="nav-item" role="presentation">
        <button class="nav-link active" id="golden-slots-tab" data-bs-toggle="tab" data-bs-target="#golden-slots" type="button">
          <i class="bi bi-clock me-2"></i>Ø§Ù„Ø³Ø§Ø¹Ø§Øª Ø§Ù„Ø°Ù‡Ø¨ÙŠØ©
        </button>
      </li>
      <li class="nav-item" role="presentation">
        <button class="nav-link" id="my-requests-tab" data-bs-toggle="tab" data-bs-target="#my-requests" type="button">
          <i class="bi bi-send me-2"></i>Ø·Ù„Ø¨Ø§ØªÙŠ Ø§Ù„Ù…Ø±Ø³Ù„Ø©
        </button>
      </li>
      <li class="nav-item" role="presentation">
        <button class="nav-link" id="received-requests-tab" data-bs-toggle="tab" data-bs-target="#received-requests" type="button">
          <i class="bi bi-inbox me-2"></i>Ø·Ù„Ø¨Ø§ØªÙŠ Ø§Ù„Ù…Ø³ØªÙ„Ù…Ø©
        </button>
      </li>
      <li class="nav-item" role="presentation">
        <button class="nav-link" id="how-it-works-tab" data-bs-toggle="tab" data-bs-target="#how-it-works" type="button">
          <i class="bi bi-info-circle me-2"></i>ÙƒÙŠÙ ÙŠØ¹Ù…Ù„ Ø§Ù„Ù†Ø¸Ø§Ù…
        </button>
      </li>
    </ul>

    <div class="tab-content" id="playersTabContent">
      
      <!-- ØªØ¨ÙˆÙŠØ¨ Ø§Ù„Ø³Ø§Ø¹Ø§Øª Ø§Ù„Ø°Ù‡Ø¨ÙŠØ© -->
      <div class="tab-pane fade show active" id="golden-slots" role="tabpanel">
        <!-- Ø£Ø²Ø±Ø§Ø± Ø§Ù„ÙÙ„ØªØ±Ø© -->
        <div class="filter-buttons">
          <div class="row align-items-center">
            <div class="col-md-6">
              <h5 class="mb-0">
                <i class="bi bi-clock me-2 text-warning"></i>
                Ø§Ù„Ø³Ø§Ø¹Ø§Øª Ø§Ù„ØªÙŠ ØªØ­ØªØ§Ø¬ Ù„Ø§Ø¹Ø¨ÙŠÙ†
                <span class="activity-indicator active" id="liveIndicator"></span>
              </h5>
            </div>
            <div class="col-md-6 text-left">
              <div class="btn-group btn-group-sm">
                <button class="btn btn-outline-primary active" onclick="playersSystem.filterSlots('all')">Ø§Ù„ÙƒÙ„</button>
                <button class="btn btn-outline-primary" onclick="playersSystem.filterSlots('today')">Ø§Ù„ÙŠÙˆÙ…</button>
                <button class="btn btn-outline-primary" onclick="playersSystem.filterSlots('tomorrow')">ØºØ¯Ø§Ù‹</button>
                <button class="btn btn-outline-primary" onclick="playersSystem.filterSlots('weekend')">Ù†Ù‡Ø§ÙŠØ© Ø§Ù„Ø£Ø³Ø¨ÙˆØ¹</button>
              </div>
            </div>
          </div>
        </div>

        <!-- Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø³Ø§Ø¹Ø§Øª Ø§Ù„Ø°Ù‡Ø¨ÙŠØ© -->
        <div class="row" id="goldenSlotsContainer">
          <div class="col-12">
            <div class="empty-state">
              <i class="bi bi-clock-history"></i>
              <h5>Ø¬Ø§Ø±ÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø³Ø§Ø¹Ø§Øª Ø§Ù„Ø°Ù‡Ø¨ÙŠØ©...</h5>
              <p>ÙŠØªÙ… ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª ØªÙ„Ù‚Ø§Ø¦ÙŠØ§Ù‹</p>
            </div>
          </div>
        </div>
      </div>

      <!-- ØªØ¨ÙˆÙŠØ¨ Ø·Ù„Ø¨Ø§ØªÙŠ Ø§Ù„Ù…Ø±Ø³Ù„Ø© -->
      <div class="tab-pane fade" id="my-requests" role="tabpanel">
        <div class="filter-buttons">
          <div class="row align-items-center">
            <div class="col-md-6">
              <h5 class="mb-0">
                <i class="bi bi-send me-2 text-primary"></i>
                Ø·Ù„Ø¨Ø§Øª Ø§Ù„Ø§Ù†Ø¶Ù…Ø§Ù… Ø§Ù„ØªÙŠ Ø£Ø±Ø³Ù„ØªÙ‡Ø§
              </h5>
            </div>
            <div class="col-md-6 text-left">
              <div class="btn-group btn-group-sm">
                <button class="btn btn-outline-primary active" onclick="playersSystem.filterMyRequests('all')">Ø§Ù„ÙƒÙ„</button>
                <button class="btn btn-outline-primary" onclick="playersSystem.filterMyRequests('pending')">Ù‚ÙŠØ¯ Ø§Ù„Ø§Ù†ØªØ¸Ø§Ø±</button>
                <button class="btn btn-outline-primary" onclick="playersSystem.filterMyRequests('accepted')">Ù…Ù‚Ø¨ÙˆÙ„Ø©</button>
                <button class="btn btn-outline-primary" onclick="playersSystem.filterMyRequests('rejected')">Ù…Ø±ÙÙˆØ¶Ø©</button>
              </div>
            </div>
          </div>
        </div>

        <div id="myRequestsContainer">
          <div class="empty-state">
            <i class="bi bi-send"></i>
            <h5>Ù„Ù… ØªÙ‚Ù… Ø¨Ø¥Ø±Ø³Ø§Ù„ Ø£ÙŠ Ø·Ù„Ø¨Ø§Øª Ø¨Ø¹Ø¯</h5>
            <p>Ø§Ù†Ø¶Ù… Ø¥Ù„Ù‰ Ø¥Ø­Ø¯Ù‰ Ø§Ù„Ø³Ø§Ø¹Ø§Øª Ø§Ù„Ø°Ù‡Ø¨ÙŠØ© Ù„Ø¨Ø¯Ø¡ Ø§Ù„Ù„Ø¹Ø¨ Ù…Ø¹ Ø§Ù„Ø¢Ø®Ø±ÙŠÙ†</p>
          </div>
        </div>
      </div>

      <!-- ØªØ¨ÙˆÙŠØ¨ Ø·Ù„Ø¨Ø§ØªÙŠ Ø§Ù„Ù…Ø³ØªÙ„Ù…Ø© -->
      <div class="tab-pane fade" id="received-requests" role="tabpanel">
        <div class="filter-buttons">
          <div class="row align-items-center">
            <div class="col-md-6">
              <h5 class="mb-0">
                <i class="bi bi-inbox me-2 text-success"></i>
                Ø·Ù„Ø¨Ø§Øª Ø§Ù„Ø§Ù†Ø¶Ù…Ø§Ù… Ø§Ù„ØªÙŠ ØªÙ„Ù‚ÙŠØªÙ‡Ø§
              </h5>
            </div>
            <div class="col-md-6 text-left">
              <div class="btn-group btn-group-sm">
                <button class="btn btn-outline-primary active" onclick="playersSystem.filterReceivedRequests('all')">Ø§Ù„ÙƒÙ„</button>
                <button class="btn btn-outline-primary" onclick="playersSystem.filterReceivedRequests('pending')">Ù‚ÙŠØ¯ Ø§Ù„Ø§Ù†ØªØ¸Ø§Ø±</button>
                <button class="btn btn-outline-primary" onclick="playersSystem.filterReceivedRequests('accepted')">Ù…Ù‚Ø¨ÙˆÙ„Ø©</button>
                <button class="btn btn-outline-primary" onclick="playersSystem.filterReceivedRequests('rejected')">Ù…Ø±ÙÙˆØ¶Ø©</button>
              </div>
            </div>
          </div>
        </div>

        <div id="receivedRequestsContainer">
          <div class="empty-state">
            <i class="bi bi-inbox"></i>
            <h5>Ù„Ø§ ØªÙˆØ¬Ø¯ Ø·Ù„Ø¨Ø§Øª Ù…Ø³ØªÙ„Ù…Ø©</h5>
            <p>Ø¹Ù†Ø¯Ù…Ø§ ØªØ·Ù„Ø¨ Ù„Ø§Ø¹Ø¨ÙŠÙ† Ù„Ø­Ø¬Ø²ÙƒØŒ Ø³ØªØ¸Ù‡Ø± Ø§Ù„Ø·Ù„Ø¨Ø§Øª Ù‡Ù†Ø§</p>
          </div>
        </div>
      </div>

      <!-- ØªØ¨ÙˆÙŠØ¨ ÙƒÙŠÙ ÙŠØ¹Ù…Ù„ Ø§Ù„Ù†Ø¸Ø§Ù… -->
      <div class="tab-pane fade" id="how-it-works" role="tabpanel">
        <div class="row">
          <div class="col-lg-8 mx-auto">
            <div class="card shadow-sm">
              <div class="card-body">
                <h4 class="card-title text-center mb-4">
                  <i class="bi bi-info-circle me-2 text-primary"></i>
                  ÙƒÙŠÙ ÙŠØ¹Ù…Ù„ Ù†Ø¸Ø§Ù… "Ù„Ø§Ø¹Ø¨ÙˆÙ†ÙŠ Ù…Ø¹Ø§ÙƒÙ…"ØŸ
                </h4>
                
                <div class="row text-center">
                  <div class="col-md-4 mb-4">
                    <div class="p-3">
                      <div class="bg-primary text-white rounded-circle d-inline-flex align-items-center justify-content-center mb-3" style="width: 80px; height: 80px;">
                        <i class="bi bi-clock display-6"></i>
                      </div>
                      <h5>Ø§Ø®ØªØ± Ø³Ø§Ø¹Ø© Ø°Ù‡Ø¨ÙŠØ©</h5>
                      <p class="text-muted">Ø§Ø¨Ø­Ø« Ø¹Ù† Ø§Ù„Ø³Ø§Ø¹Ø§Øª Ø§Ù„ØªÙŠ ØªØ­ØªØ§Ø¬ Ù„Ø§Ø¹Ø¨ÙŠÙ† Ø¥Ø¶Ø§ÙÙŠÙŠÙ†</p>
                    </div>
                  </div>
                  <div class="col-md-4 mb-4">
                    <div class="p-3">
                      <div class="bg-success text-white rounded-circle d-inline-flex align-items-center justify-content-center mb-3" style="width: 80px; height: 80px;">
                        <i class="bi bi-send display-6"></i>
                      </div>
                      <h5>Ø£Ø±Ø³Ù„ Ø·Ù„Ø¨ Ø§Ù†Ø¶Ù…Ø§Ù…</h5>
                      <p class="text-muted">Ù‚Ø¯Ù… Ø·Ù„Ø¨Ø§Ù‹ Ù„Ù„Ø§Ù†Ø¶Ù…Ø§Ù… Ù…Ø¹ Ù…Ø¹Ù„ÙˆÙ…Ø§ØªÙƒ ÙˆØ¹Ø¯Ø¯ Ø§Ù„Ù„Ø§Ø¹Ø¨ÙŠÙ†</p>
                    </div>
                  </div>
                  <div class="col-md-4 mb-4">
                    <div class="p-3">
                      <div class="bg-warning text-white rounded-circle d-inline-flex align-items-center justify-content-center mb-3" style="width: 80px; height: 80px;">
                        <i class="bi bi-people display-6"></i>
                      </div>
                      <h5>Ø§Ù„Ø¹Ø¨ ÙˆØ§Ø³ØªÙ…ØªØ¹</h5>
                      <p class="text-muted">Ø§Ù†ØªØ¸Ø± Ø§Ù„Ù‚Ø¨ÙˆÙ„ ÙˆØ§Ù†Ø¶Ù… Ù„Ù„Ù…Ø¨Ø§Ø±Ø§Ø© ÙˆØ§Ø³ØªÙ…ØªØ¹ Ø¨Ø§Ù„Ù„Ø¹Ø¨Ø©</p>
                    </div>
                  </div>
                </div>

                <div class="mt-4">
                  <h5>Ø£Ø³Ø¦Ù„Ø© Ø´Ø§Ø¦Ø¹Ø©</h5>
                  <div class="accordion" id="faqAccordion">
                    <div class="accordion-item">
                      <h2 class="accordion-header">
                        <button class="accordion-button" type="button" data-bs-toggle="collapse" data-bs-target="#faq1">
                          ÙƒÙŠÙ Ø£Ø¹Ø±Ù Ø£Ù† Ø·Ù„Ø¨ÙŠ Ù‚Ø¯ ØªÙ… Ù‚Ø¨ÙˆÙ„Ù‡ØŸ
                        </button>
                      </h2>
                      <div id="faq1" class="accordion-collapse collapse show" data-bs-parent="#faqAccordion">
                        <div class="accordion-body">
                          Ø³ØªØªÙ„Ù‚Ù‰ Ø¥Ø´Ø¹Ø§Ø±Ø§Ù‹ ÙÙˆØ±Ø§Ù‹ Ø¹Ù†Ø¯ Ù‚Ø¨ÙˆÙ„ Ø·Ù„Ø¨ÙƒØŒ ÙˆÙŠÙ…ÙƒÙ†Ùƒ Ù…ØªØ§Ø¨Ø¹Ø© Ø­Ø§Ù„Ø© Ø§Ù„Ø·Ù„Ø¨ Ù…Ù† ØªØ¨ÙˆÙŠØ¨ "Ø·Ù„Ø¨Ø§ØªÙŠ Ø§Ù„Ù…Ø±Ø³Ù„Ø©"
                        </div>
                      </div>
                    </div>
                    <div class="accordion-item">
                      <h2 class="accordion-header">
                        <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#faq2">
                          Ù‡Ù„ ÙŠÙ…ÙƒÙ†Ù†ÙŠ Ø¥Ù„ØºØ§Ø¡ Ø·Ù„Ø¨ Ø§Ù„Ø§Ù†Ø¶Ù…Ø§Ù… Ø¨Ø¹Ø¯ Ø¥Ø±Ø³Ø§Ù„Ù‡ØŸ
                        </button>
                      </h2>
                      <div id="faq2" class="accordion-collapse collapse" data-bs-parent="#faqAccordion">
                        <div class="accordion-body">
                          Ù†Ø¹Ù…ØŒ ÙŠÙ…ÙƒÙ†Ùƒ Ø¥Ù„ØºØ§Ø¡ Ø§Ù„Ø·Ù„Ø¨ ÙÙŠ Ø£ÙŠ ÙˆÙ‚Øª Ù‚Ø¨Ù„ Ù‚Ø¨ÙˆÙ„Ù‡ Ù…Ù† Ù‚Ø¨Ù„ Ù…Ù†Ø¸Ù… Ø§Ù„Ù…Ø¨Ø§Ø±Ø§Ø©
                        </div>
                      </div>
                    </div>
                    <div class="accordion-item">
                      <h2 class="accordion-header">
                        <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#faq3">
                          ÙƒÙŠÙ Ø£Ø·Ù„Ø¨ Ù„Ø§Ø¹Ø¨ÙŠÙ† Ø¥Ø¶Ø§ÙÙŠÙŠÙ† Ù„Ø­Ø¬Ø²ÙŠØŸ
                        </button>
                      </h2>
                      <div id="faq3" class="accordion-collapse collapse" data-bs-parent="#faqAccordion">
                        <div class="accordion-body">
                          Ù…Ù† ØµÙØ­Ø© Ù…Ù„ÙÙƒ Ø§Ù„Ø´Ø®ØµÙŠØŒ Ø§Ø¶ØºØ· Ø¹Ù„Ù‰ "Ø·Ù„Ø¨ Ù„Ø§Ø¹Ø¨ÙŠÙ†" ÙÙŠ ØªÙØ§ØµÙŠÙ„ Ø§Ù„Ø­Ø¬Ø²ØŒ ÙˆØ³ÙŠØ¸Ù‡Ø± Ø­Ø¬Ø²Ùƒ ÙÙŠ Ø§Ù„Ø³Ø§Ø¹Ø§Øª Ø§Ù„Ø°Ù‡Ø¨ÙŠØ©
                        </div>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Ù…ÙˆØ¯Ø§Ù„ Ø·Ù„Ø¨ Ø§Ù„Ø§Ù†Ø¶Ù…Ø§Ù… -->
  <div class="modal fade" id="joinRequestModal" tabindex="-1">
    <div class="modal-dialog modal-dialog-centered">
      <div class="modal-content">
        <div class="modal-header bg-warning text-white">
          <h5 class="modal-title">
            <i class="bi bi-person-plus me-2"></i>Ø·Ù„Ø¨ Ø§Ù„Ø§Ù†Ø¶Ù…Ø§Ù… Ù„Ù„Ù…Ø¨Ø§Ø±Ø§Ø©
          </h5>
          <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
        </div>
        <div class="modal-body">
          <div id="slotDetails" class="mb-3"></div>
          <form id="joinRequestForm">
            <input type="hidden" id="selectedTimeSlotId">
            
            <div class="mb-3">
              <label class="form-label">Ø§Ø³Ù…Ùƒ Ø§Ù„ÙƒØ§Ù…Ù„</label>
              <input type="text" class="form-control" id="requesterName" required>
            </div>
            
            <div class="mb-3">
              <label class="form-label">Ø¹Ù…Ø±Ùƒ</label>
              <input type="number" class="form-control" id="requesterAge" min="15" max="60" required>
            </div>
            
            <div class="mb-3">
              <label class="form-label">Ø¹Ø¯Ø¯ Ø§Ù„Ù„Ø§Ø¹Ø¨ÙŠÙ† Ù…Ø¹Ùƒ</label>
              <input type="number" class="form-control" id="playersCount" min="1" max="10" value="1" required>
              <div class="form-text">Ø§Ø¯Ø®Ù„ Ø¹Ø¯Ø¯ Ø§Ù„Ù„Ø§Ø¹Ø¨ÙŠÙ† Ø§Ù„Ø°ÙŠÙ† Ø³ÙŠÙ†Ø¶Ù…ÙˆÙ† Ù…Ø¹Ùƒ Ù„Ù„Ù…Ø¨Ø§Ø±Ø§Ø©</div>
            </div>
            
            <div class="mb-3">
              <label class="form-label">Ù…Ø³ØªÙˆØ§Ùƒ ÙÙŠ Ø§Ù„Ù„Ø¹Ø¨</label>
              <select class="form-select" id="skillLevel">
                <option value="beginner">Ù…Ø¨ØªØ¯Ø¦</option>
                <option value="intermediate">Ù…ØªÙˆØ³Ø·</option>
                <option value="advanced">Ù…ØªÙ‚Ø¯Ù…</option>
                <option value="expert">Ù…Ø­ØªØ±Ù</option>
              </select>
            </div>
            
            <div class="mb-3">
              <label class="form-label">Ù…Ù„Ø§Ø­Ø¸Ø© (Ø§Ø®ØªÙŠØ§Ø±ÙŠ)</label>
              <textarea class="form-control" id="requestComment" rows="3" placeholder="Ø£Ø®Ø¨Ø± Ø§Ù„Ù…Ù†Ø¸Ù… Ø¹Ù† Ù…Ø³ØªÙˆØ§Ùƒ ÙÙŠ Ø§Ù„Ù„Ø¹Ø¨ Ø£Ùˆ Ø£ÙŠ Ù…Ù„Ø§Ø­Ø¸Ø§Øª..."></textarea>
            </div>
            
            <button type="submit" class="btn btn-warning w-100 text-white fw-bold" id="submitRequestBtn">
              <i class="bi bi-send me-2"></i>Ø¥Ø±Ø³Ø§Ù„ Ø·Ù„Ø¨ Ø§Ù„Ø§Ù†Ø¶Ù…Ø§Ù…
            </button>
          </form>
        </div>
      </div>
    </div>
  </div>

  <!-- Ù…ÙˆØ¯Ø§Ù„ ØªÙØ§ØµÙŠÙ„ Ø§Ù„Ø³Ø§Ø¹Ø© Ø§Ù„Ø°Ù‡Ø¨ÙŠØ© -->
  <div class="modal fade" id="slotDetailsModal" tabindex="-1">
    <div class="modal-dialog modal-lg">
      <div class="modal-content">
        <div class="modal-header bg-primary text-white">
          <h5 class="modal-title">
            <i class="bi bi-info-circle me-2"></i>ØªÙØ§ØµÙŠÙ„ Ø§Ù„Ø³Ø§Ø¹Ø© Ø§Ù„Ø°Ù‡Ø¨ÙŠØ©
          </h5>
          <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
        </div>
        <div class="modal-body" id="slotDetailsContent">
          <!-- Ø³ÙŠØªÙ… ØªØ¹Ø¨Ø¦Ø© Ø§Ù„ØªÙØ§ØµÙŠÙ„ Ù‡Ù†Ø§ -->
        </div>
      </div>
    </div>
  </div>

  <!-- Toast Container -->
  <div class="toast-container"></div>

  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
  <script>
    // ğŸ¯ Ù†Ø¸Ø§Ù… Ù„Ø§Ø¹Ø¨ÙˆÙ†ÙŠ Ù…Ø¹Ø§ÙƒÙ… Ø§Ù„Ù…ØªÙƒØ§Ù…Ù„ ÙˆØ§Ù„Ù…Ø­Ø³Ù†
    class PlayersSystem {
      constructor() {
        this.goldenSlots = [];
        this.myRequests = [];
        this.receivedRequests = [];
        this.stats = {
          totalGoldenSlots: 0,
          totalRequests: 0,
          acceptedRequests: 0,
          activePlayers: 0
        };
        this.intervalId = null;
        this.isAuthenticated = false;
        this.authToken = localStorage.getItem('authToken');
      }

      async init() {
        await this.checkAuth();
        if (!this.isAuthenticated) return;

        this.setupEventListeners();
        await this.loadAllData();
        this.startAutoRefresh();
        this.prefillUserData();
      }

      async checkAuth() {
        try {
          if (!this.authToken) {
            this.showToast('ÙŠØ¬Ø¨ ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ Ø£ÙˆÙ„Ø§Ù‹', 'error');
            setTimeout(() => window.location.href = '/login.html', 2000);
            return;
          }

          const response = await fetch('/api/auth/check', {
            headers: {
              'Authorization': `Bearer ${this.authToken}`
            }
          });

          if (response.ok) {
            this.isAuthenticated = true;
          } else {
            throw new Error('Not authenticated');
          }
        } catch (error) {
          this.showToast('Ø¬Ù„Ø³Ø© Ø§Ù„Ø¹Ù…Ù„ Ù…Ù†ØªÙ‡ÙŠØ©ØŒ ÙŠØ±Ø¬Ù‰ ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ Ù…Ø±Ø© Ø£Ø®Ø±Ù‰', 'error');
          setTimeout(() => window.location.href = '/login.html', 2000);
        }
      }

      async safeFetch(url, options = {}) {
        try {
          const defaultOptions = {
            headers: {
              'Content-Type': 'application/json',
              'Authorization': `Bearer ${this.authToken}`,
              ...options.headers
            }
          };

          const response = await fetch(url, { ...defaultOptions, ...options });
          
          if (!response.ok) {
            throw new Error(`HTTP error! status: ${response.status}`);
          }

          return await response.json();
        } catch (error) {
          console.error('Fetch error:', error);
          throw error;
        }
      }

      async loadAllData() {
        try {
          this.showLoadingState();
          await Promise.all([
            this.loadGoldenSlots(),
            this.loadMyRequests(),
            this.loadReceivedRequests(),
            this.loadStats()
          ]);
          this.hideLoadingState();
        } catch (error) {
          console.error('Error loading players data:', error);
          this.showToast('Ø­Ø¯Ø« Ø®Ø·Ø£ ÙÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª', 'error');
          this.hideLoadingState();
        }
      }

      async loadGoldenSlots() {
        try {
          const data = await this.safeFetch('/api/golden-slots');
          this.goldenSlots = data;
          this.displayGoldenSlots();
          this.updateStats();
        } catch (error) {
          console.error('Error loading golden slots:', error);
          // Ø¨ÙŠØ§Ù†Ø§Øª ØªØ¬Ø±ÙŠØ¨ÙŠØ© Ù„Ù„Ø¹Ø±Ø¶
          this.goldenSlots = this.getMockGoldenSlots();
          this.displayGoldenSlots();
        }
      }

      async loadMyRequests() {
        try {
          const data = await this.safeFetch('/api/user/player-requests/sent');
          this.myRequests = data;
          this.displayMyRequests();
          this.updateStats();
        } catch (error) {
          console.error('Error loading my requests:', error);
          this.myRequests = [];
          this.displayMyRequests();
        }
      }

      async loadReceivedRequests() {
        try {
          const data = await this.safeFetch('/api/user/player-requests/received');
          this.receivedRequests = data;
          this.displayReceivedRequests();
          this.updateStats();
        } catch (error) {
          console.error('Error loading received requests:', error);
          this.receivedRequests = [];
          this.displayReceivedRequests();
        }
      }

      async loadStats() {
        try {
          const data = await this.safeFetch('/api/players/stats');
          this.stats = data;
          this.updateStatsDisplay();
        } catch (error) {
          console.error('Error loading stats:', error);
          this.updateStats();
        }
      }

      displayGoldenSlots() {
        const container = document.getElementById('goldenSlotsContainer');
        
        if (this.goldenSlots.length === 0) {
          container.innerHTML = `
            <div class="col-12">
              <div class="empty-state">
                <i class="bi bi-clock-history"></i>
                <h5>Ù„Ø§ ØªÙˆØ¬Ø¯ Ø³Ø§Ø¹Ø§Øª Ø°Ù‡Ø¨ÙŠØ© Ø­Ø§Ù„ÙŠØ§Ù‹</h5>
                <p>ÙŠÙ…ÙƒÙ†Ùƒ Ø§Ù„ØªØ­Ù‚Ù‚ Ù„Ø§Ø­Ù‚Ø§Ù‹ Ø£Ùˆ Ø·Ù„Ø¨ Ù„Ø§Ø¹Ø¨ÙŠÙ† Ù„Ø­Ø¬Ø²Ùƒ Ø§Ù„Ø­Ø§Ù„ÙŠ</p>
              </div>
            </div>
          `;
          return;
        }

        container.innerHTML = this.goldenSlots.map(slot => `
          <div class="col-lg-6 mb-4">
            <div class="golden-slot-card">
              <div class="row align-items-center">
                <div class="col-md-8">
                  <h5 class="mb-2">${slot.stadium_name}</h5>
                  <p class="mb-2 text-muted">
                    <i class="bi bi-geo-alt me-1"></i>${slot.location || 'ØºÙŠØ± Ù…Ø­Ø¯Ø¯'}
                    <span class="location-badge ms-2">${this.getAreaName(slot.area)}</span>
                  </p>
                  <p class="mb-2">
                    <i class="bi bi-calendar me-1"></i>${this.formatDate(slot.date)}
                    <i class="bi bi-clock ms-2 me-1"></i>${slot.start_time} - ${slot.end_time}
                  </p>
                  <p class="mb-2">
                    <span class="players-needed-badge">
                      <i class="bi bi-people me-1"></i>Ø¨Ø­Ø§Ø¬Ø© Ù„Ù€ ${slot.players_needed} Ù„Ø§Ø¹Ø¨ÙŠÙ†
                    </span>
                  </p>
                  <p class="mb-0 text-muted small">
                    <i class="bi bi-person me-1"></i>Ù…Ù†Ø¸Ù… Ø§Ù„Ù…Ø¨Ø§Ø±Ø§Ø©: ${slot.booker_name}
                  </p>
                </div>
                <div class="col-md-4 text-left">
                  <div class="d-flex flex-column gap-2">
                    <button class="btn join-btn" onclick="playersSystem.showJoinRequestModal(${slot.id})">
                      <i class="bi bi-person-plus me-1"></i>Ø§Ù†Ø¶Ù… Ù„Ù„Ù…Ø¨Ø§Ø±Ø§Ø©
                    </button>
                    <button class="btn btn-outline-primary btn-sm" onclick="playersSystem.showSlotDetails(${slot.id})">
                      <i class="bi bi-info-circle me-1"></i>ØªÙØ§ØµÙŠÙ„
                    </button>
                  </div>
                </div>
              </div>
            </div>
          </div>
        `).join('');
      }

      displayMyRequests() {
        const container = document.getElementById('myRequestsContainer');
        
        if (this.myRequests.length === 0) {
          container.innerHTML = `
            <div class="empty-state">
              <i class="bi bi-send"></i>
              <h5>Ù„Ù… ØªÙ‚Ù… Ø¨Ø¥Ø±Ø³Ø§Ù„ Ø£ÙŠ Ø·Ù„Ø¨Ø§Øª Ø¨Ø¹Ø¯</h5>
              <p>Ø§Ù†Ø¶Ù… Ø¥Ù„Ù‰ Ø¥Ø­Ø¯Ù‰ Ø§Ù„Ø³Ø§Ø¹Ø§Øª Ø§Ù„Ø°Ù‡Ø¨ÙŠØ© Ù„Ø¨Ø¯Ø¡ Ø§Ù„Ù„Ø¹Ø¨ Ù…Ø¹ Ø§Ù„Ø¢Ø®Ø±ÙŠÙ†</p>
            </div>
          `;
          return;
        }

        container.innerHTML = this.myRequests.map(request => `
          <div class="request-card ${request.status}">
            <div class="row align-items-center">
              <div class="col-md-8">
                <h6 class="mb-2">${request.stadium_name}</h6>
                <p class="mb-2 text-muted">
                  <i class="bi bi-calendar me-1"></i>${request.date}
                  <i class="bi bi-clock ms-2 me-1"></i>${request.time}
                </p>
                <p class="mb-2">
                  <span class="badge ${this.getRequestStatusClass(request.status)}">
                    ${this.getRequestStatusText(request.status)}
                  </span>
                  <span class="badge bg-secondary ms-1">${request.players_count} Ù„Ø§Ø¹Ø¨</span>
                </p>
                <p class="mb-0 text-muted small">
                  <i class="bi bi-clock me-1"></i>${new Date(request.created_at).toLocaleDateString('ar-EG')}
                </p>
              </div>
              <div class="col-md-4 text-left">
                ${request.status === 'pending' ? `
                  <button class="btn btn-outline-danger btn-sm" onclick="playersSystem.cancelRequest('${request.id}')">
                    <i class="bi bi-x-circle me-1"></i>Ø¥Ù„ØºØ§Ø¡ Ø§Ù„Ø·Ù„Ø¨
                  </button>
                ` : `
                  <button class="btn btn-outline-primary btn-sm" onclick="playersSystem.viewRequestDetails('${request.id}')">
                    <i class="bi bi-eye me-1"></i>Ø¹Ø±Ø¶ Ø§Ù„ØªÙØ§ØµÙŠÙ„
                  </button>
                `}
              </div>
            </div>
          </div>
        `).join('');
      }

      displayReceivedRequests() {
        const container = document.getElementById('receivedRequestsContainer');
        
        if (this.receivedRequests.length === 0) {
          container.innerHTML = `
            <div class="empty-state">
              <i class="bi bi-inbox"></i>
              <h5>Ù„Ø§ ØªÙˆØ¬Ø¯ Ø·Ù„Ø¨Ø§Øª Ù…Ø³ØªÙ„Ù…Ø©</h5>
              <p>Ø¹Ù†Ø¯Ù…Ø§ ØªØ·Ù„Ø¨ Ù„Ø§Ø¹Ø¨ÙŠÙ† Ù„Ø­Ø¬Ø²ÙƒØŒ Ø³ØªØ¸Ù‡Ø± Ø§Ù„Ø·Ù„Ø¨Ø§Øª Ù‡Ù†Ø§</p>
            </div>
          `;
          return;
        }

        container.innerHTML = this.receivedRequests.map(request => `
          <div class="request-card ${request.status}">
            <div class="row align-items-center">
              <div class="col-md-8">
                <h6 class="mb-2">${request.requester_name} (${request.requester_age} Ø³Ù†Ø©)</h6>
                <p class="mb-2 text-muted">
                  <i class="bi bi-people me-1"></i>${request.players_count} Ù„Ø§Ø¹Ø¨
                  <i class="bi bi-star ms-2 me-1"></i>${this.getSkillLevelText(request.skill_level)}
                </p>
                <p class="mb-2">${request.comment || 'Ù„Ø§ ØªÙˆØ¬Ø¯ Ù…Ù„Ø§Ø­Ø¸Ø§Øª'}</p>
                <p class="mb-2">
                  <span class="badge ${this.getRequestStatusClass(request.status)}">
                    ${this.getRequestStatusText(request.status)}
                  </span>
                </p>
                <p class="mb-0 text-muted small">
                  <i class="bi bi-clock me-1"></i>${new Date(request.created_at).toLocaleDateString('ar-EG')}
                </p>
              </div>
              <div class="col-md-4 text-left">
                ${request.status === 'pending' ? `
                  <div class="btn-group-vertical">
                    <button class="btn btn-success btn-sm mb-1" onclick="playersSystem.respondToRequest('${request.id}', 'accept')">
                      <i class="bi bi-check me-1"></i>Ù‚Ø¨ÙˆÙ„
                    </button>
                    <button class="btn btn-danger btn-sm" onclick="playersSystem.respondToRequest('${request.id}', 'reject')">
                      <i class="bi bi-x me-1"></i>Ø±ÙØ¶
                    </button>
                  </div>
                ` : `
                  <button class="btn btn-outline-primary btn-sm" onclick="playersSystem.viewRequestDetails('${request.id}')">
                    <i class="bi bi-eye me-1"></i>Ø¹Ø±Ø¶
                  </button>
                `}
              </div>
            </div>
          </div>
        `).join('');
      }

      showJoinRequestModal(timeSlotId) {
        const slot = this.goldenSlots.find(s => s.id === timeSlotId);
        if (!slot) return;

        document.getElementById('selectedTimeSlotId').value = timeSlotId;
        document.getElementById('slotDetails').innerHTML = `
          <div class="alert alert-info">
            <h6>ØªÙØ§ØµÙŠÙ„ Ø§Ù„Ø³Ø§Ø¹Ø© Ø§Ù„Ø°Ù‡Ø¨ÙŠØ©:</h6>
            <p class="mb-1"><strong>Ø§Ù„Ù…Ù„Ø¹Ø¨:</strong> ${slot.stadium_name}</p>
            <p class="mb-1"><strong>Ø§Ù„ØªØ§Ø±ÙŠØ®:</strong> ${this.formatDate(slot.date)}</p>
            <p class="mb-1"><strong>Ø§Ù„ÙˆÙ‚Øª:</strong> ${slot.start_time} - ${slot.end_time}</p>
            <p class="mb-0"><strong>Ø§Ù„Ù„Ø§Ø¹Ø¨ÙŠÙ† Ø§Ù„Ù…Ø·Ù„ÙˆØ¨ÙŠÙ†:</strong> ${slot.players_needed}</p>
          </div>
        `;

        // ØªØ¹Ø¨Ø¦Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ù…Ù† Ø§Ù„Ù…Ù„Ù Ø§Ù„Ø´Ø®ØµÙŠ
        this.prefillUserData();

        const modal = new bootstrap.Modal(document.getElementById('joinRequestModal'));
        modal.show();
      }

      showSlotDetails(timeSlotId) {
        const slot = this.goldenSlots.find(s => s.id === timeSlotId);
        if (!slot) return;

        const modalContent = document.getElementById('slotDetailsContent');
        modalContent.innerHTML = `
          <div class="row">
            <div class="col-md-6">
              <h6>Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„Ø³Ø§Ø¹Ø©</h6>
              <p><strong>Ø§Ù„Ù…Ù„Ø¹Ø¨:</strong> ${slot.stadium_name}</p>
              <p><strong>Ø§Ù„Ù…ÙˆÙ‚Ø¹:</strong> ${slot.location || 'ØºÙŠØ± Ù…Ø­Ø¯Ø¯'}</p>
              <p><strong>Ø§Ù„ØªØ§Ø±ÙŠØ®:</strong> ${this.formatDate(slot.date)}</p>
              <p><strong>Ø§Ù„ÙˆÙ‚Øª:</strong> ${slot.start_time} - ${slot.end_time}</p>
              <p><strong>Ø§Ù„Ø³Ø¹Ø±:</strong> ${slot.price} Ø¬.Ù…</p>
            </div>
            <div class="col-md-6">
              <h6>Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„Ù…Ù†Ø¸Ù…</h6>
              <p><strong>Ø§Ù„Ø§Ø³Ù…:</strong> ${slot.booker_name}</p>
              <p><strong>Ø§Ù„Ù„Ø§Ø¹Ø¨ÙŠÙ† Ø§Ù„Ù…Ø·Ù„ÙˆØ¨ÙŠÙ†:</strong> ${slot.players_needed}</p>
              <p><strong>Ù†ÙˆØ¹ Ø§Ù„Ù…Ù„Ø¹Ø¨:</strong> ${slot.type === 'natural' ? 'Ù†Ø¬ÙŠÙ„Ø© Ø·Ø¨ÙŠØ¹ÙŠØ©' : 'Ù†Ø¬ÙŠÙ„Ø© ØµÙ†Ø§Ø¹ÙŠØ©'}</p>
              <p><strong>Ø§Ù„Ù…Ù…ÙŠØ²Ø§Øª:</strong> ${slot.features ? slot.features.join('ØŒ ') : 'ØºÙŠØ± Ù…ØªÙˆÙØ±'}</p>
            </div>
          </div>
          <div class="mt-3 text-center">
            <button class="btn join-btn btn-lg" onclick="playersSystem.showJoinRequestModal(${slot.id})">
              <i class="bi bi-person-plus me-2"></i>Ø§Ù†Ø¶Ù… Ù„Ù‡Ø°Ù‡ Ø§Ù„Ù…Ø¨Ø§Ø±Ø§Ø©
            </button>
          </div>
        `;

        const modal = new bootstrap.Modal(document.getElementById('slotDetailsModal'));
        modal.show();
      }

      async submitJoinRequest(formData) {
        const submitBtn = document.getElementById('submitRequestBtn');
        const originalText = submitBtn.innerHTML;
        
        try {
          // Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª
          if (!this.validateJoinRequest(formData)) {
            return;
          }

          submitBtn.disabled = true;
          submitBtn.innerHTML = '<span class="loading-spinner"></span> Ø¬Ø§Ø±ÙŠ Ø§Ù„Ø¥Ø±Ø³Ø§Ù„...';

          const response = await this.safeFetch('/api/player-requests', {
            method: 'POST',
            body: JSON.stringify(formData)
          });

          this.showToast('âœ… ØªÙ… Ø¥Ø±Ø³Ø§Ù„ Ø·Ù„Ø¨ Ø§Ù„Ø§Ù†Ø¶Ù…Ø§Ù… Ø¨Ù†Ø¬Ø§Ø­', 'success');
          bootstrap.Modal.getInstance(document.getElementById('joinRequestModal')).hide();
          await this.loadAllData();
          
        } catch (error) {
          console.error('Error submitting join request:', error);
          this.showToast('âŒ Ø­Ø¯Ø« Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø·Ù„Ø¨', 'error');
        } finally {
          submitBtn.disabled = false;
          submitBtn.innerHTML = originalText;
        }
      }

      validateJoinRequest(formData) {
        if (!formData.requesterName || formData.requesterName.trim().length < 2) {
          this.showToast('Ø§Ù„Ø±Ø¬Ø§Ø¡ Ø¥Ø¯Ø®Ø§Ù„ Ø§Ø³Ù… ØµØ­ÙŠØ­', 'error');
          return false;
        }

        if (!formData.requesterAge || formData.requesterAge < 15 || formData.requesterAge > 60) {
          this.showToast('Ø§Ù„Ø±Ø¬Ø§Ø¡ Ø¥Ø¯Ø®Ø§Ù„ Ø¹Ù…Ø± Ø¨ÙŠÙ† 15 Ùˆ 60 Ø³Ù†Ø©', 'error');
          return false;
        }

        if (!formData.playersCount || formData.playersCount < 1 || formData.playersCount > 10) {
          this.showToast('Ø§Ù„Ø±Ø¬Ø§Ø¡ Ø¥Ø¯Ø®Ø§Ù„ Ø¹Ø¯Ø¯ Ù„Ø§Ø¹Ø¨ÙŠÙ† Ø¨ÙŠÙ† 1 Ùˆ 10', 'error');
          return false;
        }

        return true;
      }

      async cancelRequest(requestId) {
        if (!confirm('Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† Ø¥Ù„ØºØ§Ø¡ Ù‡Ø°Ø§ Ø§Ù„Ø·Ù„Ø¨ØŸ')) return;

        try {
          await this.safeFetch(`/api/player-requests/${requestId}/cancel`, {
            method: 'DELETE'
          });

          this.showToast('âœ… ØªÙ… Ø¥Ù„ØºØ§Ø¡ Ø§Ù„Ø·Ù„Ø¨ Ø¨Ù†Ø¬Ø§Ø­', 'success');
          await this.loadAllData();
        } catch (error) {
          console.error('Error cancelling request:', error);
          this.showToast('âŒ Ø­Ø¯Ø« Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ Ø¥Ù„ØºØ§Ø¡ Ø§Ù„Ø·Ù„Ø¨', 'error');
        }
      }

      async respondToRequest(requestId, action) {
        try {
          await this.safeFetch(`/api/player-requests/${requestId}/respond`, {
            method: 'POST',
            body: JSON.stringify({ action })
          });

          const actionText = action === 'accept' ? 'Ù‚Ø¨ÙˆÙ„' : 'Ø±ÙØ¶';
          this.showToast(`âœ… ØªÙ… ${actionText} Ø§Ù„Ø·Ù„Ø¨ Ø¨Ù†Ø¬Ø§Ø­`, 'success');
          await this.loadAllData();
        } catch (error) {
          console.error('Error responding to request:', error);
          this.showToast('âŒ Ø­Ø¯Ø« Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ Ù…Ø¹Ø§Ù„Ø¬Ø© Ø§Ù„Ø·Ù„Ø¨', 'error');
        }
      }

      viewRequestDetails(requestId) {
        // ÙŠÙ…ÙƒÙ† ØªØ·ÙˆÙŠØ± Ù‡Ø°Ù‡ Ø§Ù„Ø¯Ø§Ù„Ø© Ù„Ø¹Ø±Ø¶ ØªÙØ§ØµÙŠÙ„ Ø¥Ø¶Ø§ÙÙŠØ© Ø¹Ù† Ø§Ù„Ø·Ù„Ø¨
        this.showToast('Ø¹Ø±Ø¶ ØªÙØ§ØµÙŠÙ„ Ø§Ù„Ø·Ù„Ø¨ - Ù‚ÙŠØ¯ Ø§Ù„ØªØ·ÙˆÙŠØ±', 'warning');
      }

      prefillUserData() {
        // Ù…Ø­Ø§ÙˆÙ„Ø© Ø¬Ù„Ø¨ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… Ù…Ù† localStorage Ø£Ùˆ Ù…Ù† Ø§Ù„Ù…Ù„Ù Ø§Ù„Ø´Ø®ØµÙŠ
        const userData = JSON.parse(localStorage.getItem('userProfile') || '{}');
        if (userData.nickname) {
          document.getElementById('requesterName').value = userData.nickname;
        }
        if (userData.age) {
          document.getElementById('requesterAge').value = userData.age;
        }
      }

      updateStats() {
        this.stats.totalGoldenSlots = this.goldenSlots.length;
        this.stats.totalRequests = this.myRequests.length;
        this.stats.acceptedRequests = this.myRequests.filter(req => req.status === 'accepted').length;
        this.stats.activePlayers = this.stats.totalRequests + this.stats.acceptedRequests;
        this.updateStatsDisplay();
      }

      updateStatsDisplay() {
        document.getElementById('totalGoldenSlots').textContent = this.stats.totalGoldenSlots;
        document.getElementById('totalRequests').textContent = this.stats.totalRequests;
        document.getElementById('acceptedRequests').textContent = this.stats.acceptedRequests;
        document.getElementById('activePlayers').textContent = this.stats.activePlayers;
      }

      // Ø¯ÙˆØ§Ù„ Ø§Ù„ÙÙ„ØªØ±Ø©
      filterSlots(filter) {
        // Ø³ÙŠØªÙ… ØªØ·ÙˆÙŠØ±Ù‡Ø§ Ù„Ø§Ø­Ù‚Ø§Ù‹
        this.showToast(`ØªÙ… ØªØ·Ø¨ÙŠÙ‚ ÙÙ„ØªØ±: ${filter}`, 'warning');
        
        // ØªØ­Ø¯ÙŠØ« Ø£Ø²Ø±Ø§Ø± Ø§Ù„ÙÙ„ØªØ±Ø©
        document.querySelectorAll('#golden-slots .btn-group .btn').forEach(btn => {
          btn.classList.remove('active');
        });
        event.target.classList.add('active');
      }

      filterMyRequests(filter) {
        const requests = document.querySelectorAll('#myRequestsContainer .request-card');
        requests.forEach(request => {
          const status = request.classList.contains('pending') ? 'pending' : 
                        request.classList.contains('accepted') ? 'accepted' : 'rejected';
          let show = true;
          
          if (filter !== 'all' && status !== filter) {
            show = false;
          }
          
          request.style.display = show ? 'block' : 'none';
        });

        // ØªØ­Ø¯ÙŠØ« Ø£Ø²Ø±Ø§Ø± Ø§Ù„ÙÙ„ØªØ±Ø©
        document.querySelectorAll('#my-requests .btn-group .btn').forEach(btn => {
          btn.classList.remove('active');
        });
        event.target.classList.add('active');
      }

      filterReceivedRequests(filter) {
        const requests = document.querySelectorAll('#receivedRequestsContainer .request-card');
        requests.forEach(request => {
          const status = request.classList.contains('pending') ? 'pending' : 
                        request.classList.contains('accepted') ? 'accepted' : 'rejected';
          let show = true;
          
          if (filter !== 'all' && status !== filter) {
            show = false;
          }
          
          request.style.display = show ? 'block' : 'none';
        });

        // ØªØ­Ø¯ÙŠØ« Ø£Ø²Ø±Ø§Ø± Ø§Ù„ÙÙ„ØªØ±Ø©
        document.querySelectorAll('#received-requests .btn-group .btn').forEach(btn => {
          btn.classList.remove('active');
        });
        event.target.classList.add('active');
      }

      showToast(message, type = 'info') {
        const toastContainer = document.querySelector('.toast-container');
        const toastId = 'toast-' + Date.now();
        
        const toast = document.createElement('div');
        toast.className = `toast custom-toast toast-${type} show`;
        toast.setAttribute('role', 'alert');
        toast.innerHTML = `
          <div class="toast-header text-white border-0">
            <i class="bi ${this.getToastIcon(type)} me-2"></i>
            <strong class="me-auto">${this.getToastTitle(type)}</strong>
            <button type="button" class="btn-close btn-close-white" data-bs-dismiss="toast"></button>
          </div>
          <div class="toast-body text-white">
            ${message}
          </div>
        `;

        toastContainer.appendChild(toast);

        // Ø¥Ø²Ø§Ù„Ø© Ø§Ù„ØªÙˆØ³Øª Ø¨Ø¹Ø¯ 5 Ø«ÙˆØ§Ù†ÙŠ
        setTimeout(() => {
          if (toast.parentNode) {
            toast.parentNode.removeChild(toast);
          }
        }, 5000);
      }

      getToastIcon(type) {
        const icons = {
          'success': 'bi-check-circle',
          'error': 'bi-exclamation-circle',
          'warning': 'bi-exclamation-triangle',
          'info': 'bi-info-circle'
        };
        return icons[type] || 'bi-info-circle';
      }

      getToastTitle(type) {
        const titles = {
          'success': 'Ù†Ø¬Ø§Ø­',
          'error': 'Ø®Ø·Ø£',
          'warning': 'ØªØ­Ø°ÙŠØ±',
          'info': 'Ù…Ø¹Ù„ÙˆÙ…Ø©'
        };
        return titles[type] || 'Ù…Ø¹Ù„ÙˆÙ…Ø©';
      }

      showLoadingState() {
        // ÙŠÙ…ÙƒÙ† Ø¥Ø¶Ø§ÙØ© Ù…Ø¤Ø´Ø± ØªØ­Ù…ÙŠÙ„
        document.querySelectorAll('.empty-state h5').forEach(h5 => {
          if (h5.textContent.includes('Ø¬Ø§Ø±ÙŠ ØªØ­Ù…ÙŠÙ„')) return;
          h5.innerHTML = '<span class="loading-spinner"></span> Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªØ­Ù…ÙŠÙ„...';
        });
      }

      hideLoadingState() {
        // Ø¥Ø²Ø§Ù„Ø© Ù…Ø¤Ø´Ø± Ø§Ù„ØªØ­Ù…ÙŠÙ„
      }

      startAutoRefresh() {
        this.intervalId = setInterval(() => {
          this.loadGoldenSlots();
        }, 30000);
      }

      stopAutoRefresh() {
        if (this.intervalId) {
          clearInterval(this.intervalId);
        }
      }

      setupEventListeners() {
        // Ù†Ù…ÙˆØ°Ø¬ Ø·Ù„Ø¨ Ø§Ù„Ø§Ù†Ø¶Ù…Ø§Ù…
        document.getElementById('joinRequestForm').addEventListener('submit', async (e) => {
          e.preventDefault();
          
          const formData = {
            timeSlotId: parseInt(document.getElementById('selectedTimeSlotId').value),
            requesterName: document.getElementById('requesterName').value.trim(),
            requesterAge: parseInt(document.getElementById('requesterAge').value),
            playersCount: parseInt(document.getElementById('playersCount').value),
            skillLevel: document.getElementById('skillLevel').value,
            comment: document.getElementById('requestComment').value.trim()
          };

          await this.submitJoinRequest(formData);
        });

        // Ø¥Ù„ØºØ§Ø¡ Ø§Ù„ØªØ­Ø¯ÙŠØ« Ø§Ù„ØªÙ„Ù‚Ø§Ø¦ÙŠ Ø¹Ù†Ø¯ Ù…ØºØ§Ø¯Ø±Ø© Ø§Ù„ØµÙØ­Ø©
        window.addEventListener('beforeunload', () => {
          this.stopAutoRefresh();
        });

        // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª ØªÙ„Ù‚Ø§Ø¦ÙŠØ§Ù‹
        setInterval(() => {
          this.updateStats();
        }, 10000);
      }

      // Ø¯ÙˆØ§Ù„ Ù…Ø³Ø§Ø¹Ø¯Ø©
      getAreaName(area) {
        const areas = {
          'mokatam': 'Ø§Ù„Ù…Ù‚Ø·Ù…',
          'hedaba': 'Ø§Ù„Ù‡Ø¶Ø¨Ø© Ø§Ù„ÙˆØ³Ø·ÙŠ',
          '70feddan': 'Ø§Ù„Ø³Ø¨Ø¹ÙŠÙ† ÙØ¯Ø§Ù†'
        };
        return areas[area] || area;
      }

      formatDate(dateString) {
        try {
          const date = new Date(dateString);
          const options = { weekday: 'long', year: 'numeric', month: 'long', day: 'numeric' };
          return date.toLocaleDateString('ar-EG', options);
        } catch {
          return dateString;
        }
      }

      getRequestStatusClass(status) {
        const classes = {
          'pending': 'bg-warning',
          'accepted': 'bg-success',
          'rejected': 'bg-danger'
        };
        return classes[status] || 'bg-secondary';
      }

      getRequestStatusText(status) {
        const texts = {
          'pending': 'Ù‚ÙŠØ¯ Ø§Ù„Ø§Ù†ØªØ¸Ø§Ø±',
          'accepted': 'Ù…Ù‚Ø¨ÙˆÙ„',
          'rejected': 'Ù…Ø±ÙÙˆØ¶'
        };
        return texts[status] || status;
      }

      getSkillLevelText(level) {
        const levels = {
          'beginner': 'Ù…Ø¨ØªØ¯Ø¦',
          'intermediate': 'Ù…ØªÙˆØ³Ø·',
          'advanced': 'Ù…ØªÙ‚Ø¯Ù…',
          'expert': 'Ù…Ø­ØªØ±Ù'
        };
        return levels[level] || level;
      }

      // Ø¨ÙŠØ§Ù†Ø§Øª ØªØ¬Ø±ÙŠØ¨ÙŠØ© Ù„Ù„Ø¹Ø±Ø¶
      getMockGoldenSlots() {
        return [
          {
            id: 1,
            stadium_name: "Ù†Ø§Ø¯ÙŠ Ø§Ù„Ø·ÙŠØ§Ø±Ø© - Ø§Ù„Ù…Ù„Ø¹Ø¨ Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠ",
            location: "Ø§Ù„Ù…Ù‚Ø·Ù… - Ø´Ø§Ø±Ø¹ Ø§Ù„ØªØ³Ø¹ÙŠÙ†",
            area: "mokatam",
            date: new Date(Date.now() + 86400000).toISOString().split('T')[0],
            start_time: "16:00",
            end_time: "17:00",
            players_needed: 3,
            booker_name: "Ø£Ø­Ù…Ø¯ Ù…Ø­Ù…Ø¯",
            price: 250,
            type: "artificial",
            features: ["Ù†Ø¬ÙŠÙ„Ø© ØµÙ†Ø§Ø¹ÙŠØ©", "ÙƒØ´Ø§ÙØ§Øª Ù„ÙŠÙ„ÙŠØ©"]
          },
          {
            id: 2,
            stadium_name: "Ø§Ù„Ø±Ø§Ø¹ÙŠ Ø§Ù„ØµØ§Ù„Ø­",
            location: "Ø§Ù„Ù…Ù‚Ø·Ù… - Ø´Ø§Ø±Ø¹ 9",
            area: "mokatam",
            date: new Date(Date.now() + 172800000).toISOString().split('T')[0],
            start_time: "18:00",
            end_time: "19:00",
            players_needed: 2,
            booker_name: "Ù…Ø­Ù…ÙˆØ¯ Ø¹Ø¨Ø¯Ø§Ù„Ù„Ù‡",
            price: 300,
            type: "natural",
            features: ["Ù†Ø¬ÙŠÙ„Ø© Ø·Ø¨ÙŠØ¹ÙŠØ©", "Ù…Ù‚Ø§Ø¹Ø¯ Ø¬Ù…Ø§Ù‡ÙŠØ±"]
          }
        ];
      }
    }

    // ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø®Ø±ÙˆØ¬
    async function logout() {
      try {
        await fetch('/logout', { method: 'POST' });
        localStorage.removeItem('authToken');
        localStorage.removeItem('userProfile');
        window.location.href = '/login.html';
      } catch (error) {
        window.location.href = '/login.html';
      }
    }

    // ØªÙ‡ÙŠØ¦Ø© Ø§Ù„Ù†Ø¸Ø§Ù…
    let playersSystem;
    document.addEventListener('DOMContentLoaded', function() {
      playersSystem = new PlayersSystem();
    });
  </script>
</body>
</html>
